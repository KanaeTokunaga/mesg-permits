---
title: "License Network Plots"
author: "cslovas"
format: 
  html:
    toc: true
    self-contained: true
editor: visual
---

Please review to the [License Networks](https://carlylovas.github.io/mesg-permits/R/license_networks.html) to understand which license code corresponds with which license type

```{r}
#| label:   load libraries & data 
#| echo:    false
#| message: false
#| warning: false

library(tidyverse)
library(tidygraph)
library(ggraph)
library(igraph)
library(here)
library(gmRi)
library(grid)

annual_graphs <- read_rds(here("Data", "network_graphs.rds"))

```

## Annual network plots

Each network features only the licenses available in that given year.

```{r}
#| label: annual graphs
#| echo: false
#| message: false
#| warning: false
#| column:  page
#| fig-width:  9
#| fig-height: 5
#| fig-align: center


gridExtra::marrangeGrob(annual_graphs$ggraph, layout_matrix = matrix(1:2, ncol = 2, nrow = 1, byrow= TRUE), top = NULL)

```

## Edge density

Below is the time series of network edge density. The density of a graph is the ratio of the actual number of edges and the largest possible number of edges in the graph, assuming that no multi-edges are present. A network with higher density suggests more connections within the network. In the case of license holdings, a region with a denser network means that fishers have a more diversified permit portfolio and have flexibility to participate in multiple activities.

> High modularity and low density have different subgroups of the target species that alternate over the time period, while high density implies species are being caught simultaneously (Nomura et. al, 2021)

```{r}
#| label: edge density
#| echo: false
#| message: false
#| warning: false
#| column:  page
#| fig-width:  9
#| fig-height: 7
#| fig-align: center

density <- annual_graphs %>%
  select(license_year, density) %>%
  mutate(density = as.numeric(density))

write.csv(density, here("Outputs/", "density.csv"))

ggplot(density) +
  geom_line(aes(x = license_year, y = density)) +
  ggtitle("Edge density") +
  theme_gmri(plot.title = element_text(size = 10),
             axis.text  = element_text(size = 8),
             axis.title = element_blank())
              
```

## Modularity

The data anomalies of 2016-2020 are skewing results

```{r}
#| label: modularity
#| echo: false
#| message: false
#| warning: false
#| column:  page
#| fig-width:  9
#| fig-height: 7
#| fig-align: center

modularity <- annual_graphs %>%
  select(license_year, modularity) %>%
  mutate(modularity = as.numeric(modularity))

# write.csv(density, here("Outputs/", "density.csv"))

ggplot(modularity) +
  geom_line(aes(x = license_year, y = modularity)) +
  ggtitle("Modularity") +
  theme_gmri(plot.title = element_text(size = 10),
             axis.text  = element_text(size = 8),
             axis.title = element_blank())
              
```
